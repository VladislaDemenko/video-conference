<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Video Conference Room</title>
    <link rel="stylesheet" href="/css/room.css">
</head>
<body>
<div class="room-container">
    <!-- Header -->
    <header class="room-header">
        <div class="room-info">
            <h2 id="roomName">üé• –ö–æ–º–Ω–∞—Ç–∞ –≤–∏–¥–µ–æ–∫–æ–Ω—Ñ–µ—Ä–µ–Ω—Ü–∏–∏</h2>
            <div class="participants-count">
                <span id="participantsCount">0</span> —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤
            </div>
        </div>
        <div class="room-controls">
            <button id="inviteBtn" class="btn btn-secondary">
                üì® –ü—Ä–∏–≥–ª–∞—Å–∏—Ç—å
            </button>
            <button id="leaveBtn" class="btn btn-danger">
                üö™ –í—ã–π—Ç–∏
            </button>
        </div>
    </header>

    <!-- Main Content -->
    <div class="main-content">
        <!-- Video Section -->
        <div class="video-section">
            <div id="videoGrid" class="video-grid">
                <div class="video-placeholder">
                    <div class="placeholder-icon">üë•</div>
                    <div class="placeholder-text">–£—á–∞—Å—Ç–Ω–∏–∫–∏ –ø–æ—è–≤—è—Ç—Å—è –∑–¥–µ—Å—å</div>
                </div>
            </div>

            <!-- Local Video -->
            <div class="local-video-container">
                <video id="localVideo" autoplay muted playsinline></video>
                <div class="video-info">
                    <span id="videoStatus">üìπ –ö–∞–º–µ—Ä–∞: –í–∫–ª</span>
                    <span id="audioStatus">üé§ –ú–∏–∫—Ä–æ—Ñ–æ–Ω: –í–∫–ª</span>
                </div>
                <div class="video-controls">
                    <button id="toggleVideo" class="control-btn video-active" title="–í–∫–ª—é—á–∏—Ç—å/–≤—ã–∫–ª—é—á–∏—Ç—å –≤–∏–¥–µ–æ">
                        üé•
                    </button>
                    <button id="toggleAudio" class="control-btn audio-active" title="–í–∫–ª—é—á–∏—Ç—å/–≤—ã–∫–ª—é—á–∏—Ç—å –∑–≤—É–∫">
                        üé§
                    </button>
                    <button id="screenShare" class="control-btn" title="–î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è —ç–∫—Ä–∞–Ω–∞">
                        üñ•Ô∏è
                    </button>
                    <button id="settingsBtn" class="control-btn" title="–ù–∞—Å—Ç—Ä–æ–π–∫–∏">
                        ‚öôÔ∏è
                    </button>
                </div>
            </div>
        </div>

        <!-- Sidebar -->
        <div class="sidebar">
            <!-- Participants List -->
            <div class="participants-section">
                <h3>–£—á–∞—Å—Ç–Ω–∏–∫–∏</h3>
                <div id="participantsList" class="participants-list">
                    <div class="participant current-user">
                        <span class="username">–í—ã (–ó–∞–≥—Ä—É–∑–∫–∞...)</span>
                        <span class="status connected">üü¢</span>
                    </div>
                </div>
            </div>

            <!-- Chat -->
            <div class="chat-section">
                <h3>–ß–∞—Ç</h3>
                <div id="chatMessages" class="chat-messages">
                    <div class="chat-message system-message">
                        <em>–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ –∫–æ–º–Ω–∞—Ç—É –≤–∏–¥–µ–æ–∫–æ–Ω—Ñ–µ—Ä–µ–Ω—Ü–∏–∏!</em>
                        <small>–¢–æ–ª—å–∫–æ —á—Ç–æ</small>
                    </div>
                </div>
                <div class="chat-input">
                    <input type="text" id="messageInput" placeholder="–ù–∞–ø–∏—à–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ...">
                    <button id="sendMessage">üì§ –û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Invite Modal -->
<div id="inviteModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h3>üì® –ü—Ä–∏–≥–ª–∞—Å–∏—Ç—å –≤ –∫–æ–º–Ω–∞—Ç—É</h3>
            <span class="close">&times;</span>
        </div>
        <div class="modal-body">
            <p style="color: var(--gray-light); margin-bottom: 16px; line-height: 1.5;">
                –û—Ç–ø—Ä–∞–≤—å—Ç–µ —ç—Ç—É —Å—Å—ã–ª–∫—É –¥—Ä—É–∑—å—è–º –∏–ª–∏ –∫–æ–ª–ª–µ–≥–∞–º, —á—Ç–æ–±—ã –æ–Ω–∏ –º–æ–≥–ª–∏ –ø—Ä–∏—Å–æ–µ–¥–∏–Ω–∏—Ç—å—Å—è –∫ –≤–∞—à–µ–π –≤–∏–¥–µ–æ–∫–æ–Ω—Ñ–µ—Ä–µ–Ω—Ü–∏–∏
            </p>
            <input type="text" id="inviteLink" readonly>
            <button id="copyLink" style="width: 100%; padding: 12px; background: var(--primary); color: white; border: none; border-radius: var(--border-radius); font-weight: 600; cursor: pointer; transition: all 0.3s ease; margin-top: 8px;">
                üìã –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Å—Å—ã–ª–∫—É
            </button>
            <div style="margin-top: 16px; padding: 12px; background: rgba(99, 102, 241, 0.1); border-radius: var(--border-radius); border-left: 4px solid var(--primary);">
                <p style="font-size: 0.875rem; color: var(--gray-light); margin: 0;">
                    üí° <strong>–°–æ–≤–µ—Ç:</strong> –°—Å—ã–ª–∫–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∫–æ–ø–∏—Ä—É–µ—Ç—Å—è –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∫–æ–º–Ω–∞—Ç—ã
                </p>
            </div>
        </div>
    </div>
</div>

<!-- Settings Modal -->
<div id="settingsModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h3>‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –º–µ–¥–∏–∞</h3>
            <span class="close">&times;</span>
        </div>
        <div class="modal-body">
            <div class="settings-section">
                <h4>–ö–∞–º–µ—Ä–∞</h4>
                <select id="videoSource">
                    <option value="">üìπ –í—ã–±–µ—Ä–∏—Ç–µ –∫–∞–º–µ—Ä—É</option>
                </select>
            </div>
            <div class="settings-section">
                <h4>–ú–∏–∫—Ä–æ—Ñ–æ–Ω</h4>
                <select id="audioSource">
                    <option value="">üé§ –í—ã–±–µ—Ä–∏—Ç–µ –º–∏–∫—Ä–æ—Ñ–æ–Ω</option>
                </select>
                <div class="volume-meter" style="margin-top: 8px;">
                    <div class="volume-level"></div>
                </div>
            </div>
            <div class="settings-section">
                <h4>–î–∏–Ω–∞–º–∏–∫–∏</h4>
                <select id="audioOutput">
                    <option value="">üîä –í—ã–±–µ—Ä–∏—Ç–µ –¥–∏–Ω–∞–º–∏–∫–∏</option>
                </select>
            </div>
            <div style="background: rgba(245, 158, 11, 0.1); padding: 12px; border-radius: var(--border-radius); border-left: 4px solid var(--warning); margin: 16px 0;">
                <p style="font-size: 0.875rem; color: var(--warning); margin: 0;">
                    üí° –ü–æ—Å–ª–µ —Å–º–µ–Ω—ã —É—Å—Ç—Ä–æ–π—Å—Ç–≤ –º–æ–∂–µ—Ç –ø–æ—Ç—Ä–µ–±–æ–≤–∞—Ç—å—Å—è –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å–µ–∫—É–Ω–¥ –¥–ª—è –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –Ω–∞—Å—Ç—Ä–æ–µ–∫
                </p>
            </div>
            <button id="applySettings" style="width: 100%; padding: 12px; background: var(--primary); color: white; border: none; border-radius: var(--border-radius); font-weight: 600; cursor: pointer; transition: all 0.3s ease;">
                üíæ –ü—Ä–∏–º–µ–Ω–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
            </button>
        </div>
    </div>
</div>

<!-- Permission Modal -->
<div id="permissionModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h3>üé• –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ –≤–∏–¥–µ–æ–∫–æ–Ω—Ñ–µ—Ä–µ–Ω—Ü–∏—é!</h3>
        </div>
        <div class="modal-body">
            <div style="text-align: center; margin-bottom: 24px;">
                <div style="font-size: 4rem; margin-bottom: 16px;">üé¨</div>
                <h3 style="color: var(--light); margin-bottom: 16px;">–ì–æ—Ç–æ–≤—ã –Ω–∞—á–∞—Ç—å –≤—Å—Ç—Ä–µ—á—É?</h3>
            </div>

            <p style="color: var(--gray-light); margin-bottom: 20px; line-height: 1.6;">
                –î–ª—è –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω–æ–π —Ä–∞–±–æ—Ç—ã –≤–∏–¥–µ–æ–∫–æ–Ω—Ñ–µ—Ä–µ–Ω—Ü–∏–∏ –Ω–∞–º –ø–æ—Ç—Ä–µ–±—É–µ—Ç—Å—è –¥–æ—Å—Ç—É–ø –∫:
            </p>

            <div style="display: flex; flex-direction: column; gap: 12px; margin-bottom: 24px;">
                <div style="display: flex; align-items: center; gap: 12px; padding: 12px; background: rgba(255, 255, 255, 0.05); border-radius: var(--border-radius);">
                    <div style="font-size: 1.5rem;">üìπ</div>
                    <div>
                        <div style="font-weight: 600; color: var(--light);">–ö–∞–º–µ—Ä–∞</div>
                        <div style="font-size: 0.875rem; color: var(--gray-light);">–î–ª—è –ø–µ—Ä–µ–¥–∞—á–∏ –≤–∏–¥–µ–æ</div>
                    </div>
                </div>

                <div style="display: flex; align-items: center; gap: 12px; padding: 12px; background: rgba(255, 255, 255, 0.05); border-radius: var(--border-radius);">
                    <div style="font-size: 1.5rem;">üé§</div>
                    <div>
                        <div style="font-weight: 600; color: var(--light);">–ú–∏–∫—Ä–æ—Ñ–æ–Ω</div>
                        <div style="font-size: 0.875rem; color: var(--gray-light);">–î–ª—è –ø–µ—Ä–µ–¥–∞—á–∏ –∑–≤—É–∫–∞</div>
                    </div>
                </div>
            </div>

            <div style="background: rgba(245, 158, 11, 0.1); padding: 16px; border-radius: var(--border-radius); border-left: 4px solid var(--warning); margin: 20px 0;">
                <p style="font-size: 0.875rem; color: var(--warning); margin: 0; line-height: 1.5;">
                    ‚ö†Ô∏è <strong>–í–Ω–∏–º–∞–Ω–∏–µ:</strong> –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, —Ä–∞–∑—Ä–µ—à–∏—Ç–µ –¥–æ—Å—Ç—É–ø –∫ –∫–∞–º–µ—Ä–µ –∏ –º–∏–∫—Ä–æ—Ñ–æ–Ω—É –∫–æ–≥–¥–∞ –±—Ä–∞—É–∑–µ—Ä –∑–∞–ø—Ä–æ—Å–∏—Ç —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è.
                    –ë–µ–∑ —ç—Ç–æ–≥–æ –≤–∏–¥–µ–æ–∫–æ–Ω—Ñ–µ—Ä–µ–Ω—Ü–∏—è –Ω–µ —Å–º–æ–∂–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω–æ.
                </p>
            </div>

            <div style="display: flex; gap: 12px;">
                <button id="startMedia" style="flex: 1; padding: 14px; background: var(--primary); color: white; border: none; border-radius: var(--border-radius); font-weight: 600; cursor: pointer; transition: all 0.3s ease;">
                    üé¨ –†–∞–∑—Ä–µ—à–∏—Ç—å –∏ –Ω–∞—á–∞—Ç—å
                </button>
                <button onclick="window.location.href = '/'" style="padding: 14px 24px; background: rgba(255, 255, 255, 0.1); color: var(--light); border: 1px solid rgba(255, 255, 255, 0.2); border-radius: var(--border-radius); font-weight: 600; cursor: pointer; transition: all 0.3s ease;">
                    –û—Ç–º–µ–Ω–∞
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Media Test Modal -->
<div id="mediaTestModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h3>üéöÔ∏è –ü—Ä–æ–≤–µ—Ä–∫–∞ —É—Å—Ç—Ä–æ–π—Å—Ç–≤</h3>
            <span class="close">&times;</span>
        </div>
        <div class="modal-body">
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 24px;">
                <div class="device-test">
                    <h4 style="margin-bottom: 12px; color: var(--light);">üìπ –ö–∞–º–µ—Ä–∞</h4>
                    <video id="cameraTest" autoplay muted playsinline style="width: 100%; height: 150px; background: var(--dark); border-radius: var(--border-radius);"></video>
                    <div style="margin-top: 8px; font-size: 0.875rem; color: var(--gray-light); text-align: center;">
                        –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å –∫–∞–º–µ—Ä—ã
                    </div>
                </div>
                <div class="device-test">
                    <h4 style="margin-bottom: 12px; color: var(--light);">üé§ –ú–∏–∫—Ä–æ—Ñ–æ–Ω</h4>
                    <div style="width: 100%; height: 150px; background: var(--dark); border-radius: var(--border-radius); display: flex; align-items: center; justify-content: center; flex-direction: column; gap: 12px;">
                        <div style="font-size: 2rem;">üé§</div>
                        <div class="volume-meter" style="width: 80%;">
                            <div class="volume-level"></div>
                        </div>
                    </div>
                    <div style="margin-top: 8px; font-size: 0.875rem; color: var(--gray-light); text-align: center;">
                        –ì–æ–≤–æ—Ä–∏—Ç–µ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –º–∏–∫—Ä–æ—Ñ–æ–Ω–∞
                    </div>
                </div>
            </div>

            <div style="background: rgba(16, 185, 129, 0.1); padding: 12px; border-radius: var(--border-radius); border-left: 4px solid var(--success); margin-bottom: 16px;">
                <p style="font-size: 0.875rem; color: var(--success); margin: 0;">
                    ‚úÖ –í—Å–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ —Ä–∞–±–æ—Ç–∞—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ! –í—ã –º–æ–∂–µ—Ç–µ –Ω–∞—á–∞—Ç—å –≤—Å—Ç—Ä–µ—á—É.
                </p>
            </div>

            <button onclick="document.getElementById('mediaTestModal').style.display = 'none'" style="width: 100%; padding: 12px; background: var(--success); color: white; border: none; border-radius: var(--border-radius); font-weight: 600; cursor: pointer; transition: all 0.3s ease;">
                ‚úÖ –ù–∞—á–∞—Ç—å –≤—Å—Ç—Ä–µ—á—É
            </button>
        </div>
    </div>
</div>

<script src="/webjars/sockjs-client/sockjs.min.js"></script>
<script src="/webjars/stomp-websocket/stomp.min.js"></script>
<script src="/js/room.js"></script>

<style>
    .btn-primary {
        background: linear-gradient(135deg, var(--primary) 0%, var(--primary-light) 100%);
        color: white;
        border: none;
        padding: 12px 24px;
        border-radius: var(--border-radius);
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
    }

    .btn-primary:hover {
        transform: translateY(-2px);
        box-shadow: var(--shadow);
    }

    :root {
        --primary: #6366f1;
        --primary-dark: #4f46e5;
        --primary-light: #8b5cf6;
        --secondary: #f8fafc;
        --dark: #1e293b;
        --darker: #0f172a;
        --light: #f1f5f9;
        --success: #10b981;
        --warning: #f59e0b;
        --error: #ef4444;
        --gray: #64748b;
        --gray-light: #cbd5e1;
        --shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
        --shadow-lg: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
        --border-radius: 12px;
        --border-radius-lg: 16px;
    }

    .volume-meter {
        width: 100%;
        height: 6px;
        background: rgba(255, 255, 255, 0.1);
        border-radius: 3px;
        overflow: hidden;
    }

    .volume-level {
        height: 100%;
        background: linear-gradient(135deg, var(--success) 0%, #34d399 100%);
        width: 0%;
        transition: width 0.1s ease;
        border-radius: 3px;
    }
</style>
</body>
</html>